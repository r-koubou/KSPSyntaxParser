{
    "scopeName":    "net.rkoubou.kontakt.ksp",
    "name":         "KSP",
    "comment":      "NI Kontakt Script syntax",
	"fileTypes": [
		"ksp",
        "txt"
	],

    "patterns": [
		{
			"name":    "ksp.string.quoted",
			"comment": "String literals",
			"begin": "\"",
			"beginCaptures": {
				"0": {
					"name": "ksp.definition.string.begin"
				}
			},
			"end": "\"",
			"endCaptures": {
				"0": {
					"name": "ksp.definition.string.end"
				}
			}
		},
		{
			"match": "\\\\([0-7]{3}|[abfnrtv\\\\'\"]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|U[0-9a-fA-F]{8})"
		},
		{
			"match": "%(\\[\\d+\\])?([\\+#\\-0\\x20]{,2}((\\d+|\\*)?(\\.?(\\d+|\\*|(\\[\\d+\\])\\*?)?(\\[\\d+\\])?)?))?[vT%tbcdoqxXUbeEfFgGsp]"
		},
		{
			"match": "(?<![\\d.])\\s0x[a-fA-F\\d]+|\\b\\d+(\\.\\d+)?([eE]-?\\d+)?|\\.\\d+([eE]-?\\d+)?",
			"name": "constant.numeric.ksp"
		},
		{
			"include": "#ksp_comments"
		},
		{
			"include": "#ksp_callback"
		},
		{
			"include": "#ksp_variables"
		},
		{
			"include": "#ksp_ui_controls"
		},
		{
			"include": "#ksp_control_statements"
		},
		{
			"include": "#ksp_operators"
		},
		{
			"include": "#ksp_arithmetic_commands"
		},
		{
			"include": "#ksp_builtin_functions"
		},
		{
			"include": "#ksp_ident"
		}
	],
	"repository":
	{
		"ksp_comments":
		{
			"patterns":[
				{
					"begin": "\\{",
					"captures":
					{
						"0":
						{
							"name": "punctuation.definition.comment.ksp"
						}
					},
					"end": "\\}",
					"name":"comment.block.ksp"
				}
			]
		},
		"ksp_ident":
		{
			"patterns":[{ "match": "([a-z|A-Z|_]+[a-z|A-Z|_|0-9]*)"	}]
		},
		"ksp_callback":
		{
			"patterns":[
				{
					"name":  "keyword.callback.ksp",
					"match": "on\\s+(async_complete|controller|init|listener|note|persistence_changed|pgs_changed|poly_at|release|rpn|nrpn|ui_control|ui_update)\\b"
				},
				{
					"name":  "keyword.callback.ksp",
					"match": "end\\s+on\\b"
				}
			]
		},
		"ksp_variables":
		{
			"patterns":[
				{
					"name":  "variable.reserved1.ksp",
					"match": "\\$(NI_[a-z|A-Z|0-9|_]+|CONTROL_PAR_[a-z|A-Z|0-9|_]+|EVENT_PAR_[a-z|A-Z|0-9|_]+|ENGINE_PAR_[a-z|A-Z|0-9|_]+)"
				},
				{
					"name": "variable.reserved2.special.ksp",
					"match": "\\$(ALL_GROUPS|CONTROL_PAR_ALLOW_AUTOMATION|CONTROL_PAR_AUTOMATION_NAME|CONTROL_PAR_COLUMN_WIDTH|CONTROL_PAR_DEFAULT_VALUE|CONTROL_PAR_FILE_TYPE|CONTROL_PAR_GRID_WIDTH|CONTROL_PAR_GRID_X|CONTROL_PAR_HIDE|CONTROL_PAR_KEY_CONTROL|CONTROL_PAR_KEY_SHIFT|CONTROL_PAR_MAX_VALUE|CONTROL_PAR_NONE|CONTROL_PAR_OFF_COLOR|CONTROL_PAR_OVERLOAD_COLOR|CONTROL_PAR_PICTURE_STATE|CONTROL_PAR_POS_X|CONTROL_PAR_SELECTED_ITEM_IDX|CONTROL_PAR_SHOW_ARROWS|CONTROL_PAR_TEXTLINE|CONTROL_PAR_TEXTPOS_Y|CONTROL_PAR_UNIT|CONTROL_PAR_VERTICAL|CONTROL_PAR_WIDTH|CONTROL_PAR_ZERO_LINE_COLOR|CURRENT_SCRIPT_SLOT|DURATION_BAR|DURATION_QUARTER|DURATION_QUARTER_TRIPLET|DURATION_SIXTEENTH_TRIPLET|EFFECT_TYPE_CABINET|EFFECT_TYPE_CHORUS|EFFECT_TYPE_COMPRESSOR|EFFECT_TYPE_DELAY|EFFECT_TYPE_DISTORTION|EFFECT_TYPE_FLANGER|EFFECT_TYPE_GAINER|EFFECT_TYPE_INVERTER|EFFECT_TYPE_IRC|EFFECT_TYPE_JUMP|EFFECT_TYPE_LOFI|EFFECT_TYPE_NONE|EFFECT_TYPE_PHASER|EFFECT_TYPE_REVERB|EFFECT_TYPE_ROTATOR|EFFECT_TYPE_SHAPER|EFFECT_TYPE_TAPE_SAT|EFFECT_TYPE_TRANS_MASTER|ENGINE_PAR_ATTACK|ENGINE_PAR_BANDWIDTH|ENGINE_PAR_BITS|ENGINE_PAR_BW1|ENGINE_PAR_BW3|ENGINE_PAR_CB_AIR|ENGINE_PAR_CB_BASS|ENGINE_PAR_CH_DEPTH|ENGINE_PAR_CH_SPEED_UNIT|ENGINE_PAR_COMP_ATTACK|ENGINE_PAR_CUTOFF|ENGINE_PAR_DECAY|ENGINE_PAR_DECAY1_UNIT|ENGINE_PAR_DECAY2|ENGINE_PAR_DL_PAN|ENGINE_PAR_DL_TIME_UNIT|ENGINE_PAR_DRIVE|ENGINE_PAR_EFFECT_BYPASS|ENGINE_PAR_EFFECT_SUBTYPE|ENGINE_PAR_EFFECT_TYPE|ENGINE_PAR_ENVELOPE_ORDER|ENGINE_PAR_EXP_FILTER_MORPH|ENGINE_PAR_FCOMP_ATTACK|ENGINE_PAR_FCOMP_INPUT|ENGINE_PAR_FCOMP_MAKEUP|ENGINE_PAR_FILTER_BYPA|ENGINE_PAR_FILTER_BYPC|ENGINE_PAR_FILTER_RESC|ENGINE_PAR_FILTER_SHIFTC|ENGINE_PAR_FILTER_TYPEB|ENGINE_PAR_FL_DEPTH|ENGINE_PAR_FL_FEEDBACK|ENGINE_PAR_FL_SPEED_UNIT|ENGINE_PAR_FORMANT|ENGINE_PAR_FORMANT_SIZE|ENGINE_PAR_FORMANT_TALK|ENGINE_PAR_FREQ2|ENGINE_PAR_GAIN2|ENGINE_PAR_GLIDE_COEF|ENGINE_PAR_GRAIN_LENGTH|ENGINE_PAR_HOLD|ENGINE_PAR_HP_CUTOFF|ENGINE_PAR_INTMOD_BYPASS|ENGINE_PAR_INTMOD_FREQUENCY|ENGINE_PAR_INTMOD_PULSEWIDTH|ENGINE_PAR_INTMOD_TYPE|ENGINE_PAR_IRC_FREQ_HIGHPASS_LR|ENGINE_PAR_IRC_FREQ_LOWPASS_ER|ENGINE_PAR_IRC_LENGTH_RATIO_LR|ENGINE_PAR_IRC_PREDELAY|ENGINE_PAR_JMP_HIGAIN|ENGINE_PAR_JMP_MASTER|ENGINE_PAR_JMP_MID|ENGINE_PAR_JMP_PREAMP|ENGINE_PAR_LFO_DELAY|ENGINE_PAR_LFO_RECT|ENGINE_PAR_LFO_SAW|ENGINE_PAR_LIM_IN_GAIN|ENGINE_PAR_MOD_TARGET_INTENSITY|ENGINE_PAR_NOISELEVEL|ENGINE_PAR_PH_PHASE|ENGINE_PAR_PH_SPEED|ENGINE_PAR_RELEASE_UNIT|ENGINE_PAR_RT_ACCEL_LO|ENGINE_PAR_RT_BALANCE|ENGINE_PAR_RT_MIX|ENGINE_PAR_RV_COLOUR|ENGINE_PAR_RV_DAMPING|ENGINE_PAR_RV_PREDELAY|ENGINE_PAR_SCOMP_ATTACK|ENGINE_PAR_SCOMP_MAKEUP|ENGINE_PAR_SCOMP_THRESHOLD|ENGINE_PAR_SENDLEVEL_0|ENGINE_PAR_SENDLEVEL_2|ENGINE_PAR_SEND_EFFECT_BYPASS|ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN|ENGINE_PAR_SEND_EFFECT_TYPE|ENGINE_PAR_SEQ_HF_FREQ|ENGINE_PAR_SEQ_HMF_GAIN|ENGINE_PAR_SEQ_HMF_Q|ENGINE_PAR_SEQ_LF_BELL|ENGINE_PAR_SEQ_LF_GAIN|ENGINE_PAR_SEQ_LMF_FREQ|ENGINE_PAR_SK_BASS|ENGINE_PAR_SK_MIX|ENGINE_PAR_SK_TONE|ENGINE_PAR_SLICE_RELEASE|ENGINE_PAR_SPEED_UNIT|ENGINE_PAR_SP_DIVERGENCE|ENGINE_PAR_SP_LFE_VOLUME|ENGINE_PAR_SP_OFFSET_DISTANCE|ENGINE_PAR_SP_OFFSET_X|ENGINE_PAR_START_CRITERIA_CC_MIN|ENGINE_PAR_START_CRITERIA_CYCLE_CLASS|ENGINE_PAR_START_CRITERIA_KEY_MAX|ENGINE_PAR_START_CRITERIA_MODE|ENGINE_PAR_START_CRITERIA_NEXT_CRIT|ENGINE_PAR_START_CRITERIA_SLICE_IDX|ENGINE_PAR_STEREO|ENGINE_PAR_SUSTAIN|ENGINE_PAR_THRESHOLD|ENGINE_PAR_TP_GAIN|ENGINE_PAR_TP_HF_ROLLOFF|ENGINE_PAR_TR_ATTACK|ENGINE_PAR_TUNE|ENGINE_PAR_TW_BASS|ENGINE_PAR_TW_TREBLE|ENGINE_PAR_VOLUME|ENV_TYPE_AHDSR|ENV_TYPE_DBD|EVENT_ID|EVENT_NOTE|EVENT_PAR_0|EVENT_PAR_2|EVENT_PAR_ID|EVENT_PAR_MIDI_BYTE_1|EVENT_PAR_MIDI_CHANNEL|EVENT_PAR_PLAY_POS|EVENT_PAR_POS|EVENT_PAR_SOURCE|EVENT_PAR_TUNE|EVENT_PAR_VELOCITY|EVENT_PAR_VOLUME|EVENT_PAR_ZONE_ID|EVENT_STATUS_INACTIVE|EVENT_STATUS_MIDI_QUEUE|EVENT_VELOCITY|FILTER_TYPE_AR_BP2|FILTER_TYPE_AR_BP24|FILTER_TYPE_AR_HP2|FILTER_TYPE_AR_HP24|FILTER_TYPE_AR_LP2|FILTER_TYPE_AR_LP24|FILTER_TYPE_BP4POLE|FILTER_TYPE_DAFT_LP|FILTER_TYPE_EQ2BAND|FILTER_TYPE_FORMANT_2|FILTER_TYPE_HP1POLE|FILTER_TYPE_LDR_BP2|FILTER_TYPE_LDR_HP1|FILTER_TYPE_LDR_HP3|FILTER_TYPE_LDR_LP1|FILTER_TYPE_LDR_LP3|FILTER_TYPE_LDR_PEAK|FILTER_TYPE_LP2POLE|FILTER_TYPE_LP4POLE|FILTER_TYPE_LP6POLE|FILTER_TYPE_PRO52|FILTER_TYPE_SV_BP2|FILTER_TYPE_SV_HP2|FILTER_TYPE_SV_LP2|FILTER_TYPE_SV_PAR_LPHP|FILTER_TYPE_SV_SER_LPHP|FILTER_TYPE_VERSATILE|FILTER_TYPE_VOWELA|GET_FOLDER_FACTORY_DIR|GET_FOLDER_PATCH_DIR|HIDE_PART_MOD_LIGHT|HIDE_PART_NOTHING|HIDE_PART_TITLE|HIDE_PART_VALUE|HIDE_WHOLE_CONTROL|INST_ICON_ID|INTMOD_TYPE_GLIDE|INTMOD_TYPE_LFO|INTMOD_TYPE_STEPMOD|KNOB_UNIT_HZ|KNOB_UNIT_MS|KNOB_UNIT_NONE|KNOB_UNIT_OCT|KSP_TIMER|LFO_TYPE_RANDO|LFO_TYPE_TRIANGLE|MARK_1|MARK_28|NI_ASYNC_ID|NI_BUS_OFFSET|NI_CALLBACK_ID|NI_CB_TYPE_ASYNC_OUT|NI_CB_TYPE_INIT|NI_CB_TYPE_MIDI_IN|NI_CB_TYPE_NOTE|NI_CB_TYPE_PGS|NI_CB_TYPE_RELEASE|NI_CB_TYPE_UI_CONTROL|NI_FILE_TYPE_AUDIO|NI_SIGNAL_TIMER_MS|NI_SIGNAL_TRANSP_STOP|NI_SONG_POSITION|NI_SYNC_UNIT_16TH_TRIPLET|NI_SYNC_UNIT_32ND_TRIPLET|NI_SYNC_UNIT_64TH_TRIPLET|NI_SYNC_UNIT_8TH_TRIPLET|NI_SYNC_UNIT_ABS|NI_SYNC_UNIT_HALF_TRIPLET|NI_SYNC_UNIT_QUARTER_TRIPLET|NI_SYNC_UNIT_WHOLE_TRIPLET|NI_SYNC_UNIT_ZONE|NI_VL_TMRPO_HQ|NUM_GROUPS|NUM_ZONES|PLAYED_VOICES_TOTAL|POLY_AT_NUM|RPN_VALUE|SIGNATURE_NUM|START_CRITERIA_AND_NEXT|START_CRITERIA_CYCLE_RANDOM|START_CRITERIA_NONE|START_CRITERIA_ON_CONTROLLER|START_CRITERIA_OR_NEXT|UI_WAVEFORM_TABLE_IS_BIPOLAR|UI_WAVEFORM_USE_SLICES|UI_WF_PROP_MIDI_DRAG_START_NOTE|UI_WF_PROP_PLAY_CURSOR|UI_WF_PROP_TABLE_VAL|VCC_PITCH_BEND)\\b"
				},
				{
					"name":  "variable.other.ksp",
					"match": "(\\$|\\~|\\?|@|!|\\%)([a-z|A-Z|_]+[a-z|A-Z|_|0-9]*)"
				},
				{
					"name":  "keyword.declare.ksp",
					"match": "(declare|const|polyphonic)\\b"
				}
			]
		},
		"ksp_ui_controls":
		{
			"patterns":[
				{
					"name":  "keyword.other.ui.ksp",
					"match": "(ui_button|ui_knob|ui_file_selector|ui_label|ui_level_meter|ui_menu|ui_slider|ui_switch|ui_table|ui_text_edit|ui_value_edit|ui_waveform)"
				}
			]
		},
		"ksp_control_statements":
		{
			"patterns":[
				{
					"name":  "keyword.other.statements.ksp",
					"match": "(if|else|end\\s+if|select|case|to|end\\s+select|while|end\\s+while)\\b"
				}
			]
		},
		"ksp_operators":
		{
			"patterns":[
				{
					"name":  "keyword.other.boolop.ksp",
					"match": "(\\.and\\.|\\.or\\.|\\.not\\.|sh_left|sh_right|in_range)"
				}
			]
		},
		"ksp_arithmetic_commands":
		{
			"patterns":[
				{
					"name":  "keyword.other.arithmetic.ksp",
					"match": "(inc|dec|mod)\\b"
				},
				{
					"name":  "support.function.builtin.ksp",
					"match": "(exp|log|pow|sqrt|ceil|floor|round)\\b"
				},
				{
					"name":  "support.function.builtin.ksp",
					"match": "(cos|sin|tan|acos|asin|atan)\\b"
				}
			]
		},
		"ksp_builtin_functions":
		{
			"patterns":[
				{
					"name":  "support.function.builtin.ksp",
					"match": "(make_instr_persistent|make_persistent|read_persistent_var|random|int_to_real|real_to_int|msb|lsb|message|note_off|play_note|set_controller|set_rpn|set_nrpn|set_snapshot_type|by_marks|change_note|change_pan|change_tune|change_velo|change_vol|delete_event_mark|event_status|fade_in|fade_out|get_event_ids|get_event_par|get_event_par_arr|ignore_event|set_event_mark|set_event_par|set_event_par_arr|array_equal|num_elements|search|sort|allow_group|disallow_group|find_group|get_purge_state|group_name|purge_group|change_listener_par|ms_to_ticks|set_listener|stop_wait|ticks_to_ms|wait|wait_ticks|add_menu_item|add_text_line|attach_level_meter|attach_zone|hide_part|fs_get_filename|fs_navigate|get_control_par|get_menu_item_str|get_menu_item_value|get_menu_item_visibility|get_ui_id|get_ui_wf_property|move_control|move_control_px|set_control_help|set_control_par|set_knob_defval|set_knob_label|set_knob_unit|set_menu_item_str|set_menu_item_value|set_menu_item_visibility|set_table_steps_shown|set_script_title|set_skin_offset|set_text|set_ui_color|set_ui_height|set_ui_height_px|set_ui_width_px|set_ui_wf_property|get_key_color|get_key_name|get_key_triggerstate|get_key_type|get_keyrange_min_note|get_keyrange_max_note|get_keyrange_name|set_key_color|set_key_name|set_key_pressed|set_key_pressed_support|set_key_type|set_keyrange|remove_keyrange|find_mod|find_target|get_engine_par|get_engine_par_disp|get_voice_limit|output_channel_name|set_engine_par|set_voice_limit|get_folder|load_array|load_array_str|load_ir_sample|save_array|save_array_str|save_midi_file|mf_insert_file|mf_set_export_area|mf_set_buffer_size|mf_get_buffer_size|mf_reset|mf_insert_event|mf_remove_event|mf_set_event_par|mf_get_event_par|mf_get_id|mf_set_mark|mf_get_mark|by_marks|by_track|mf_get_first|mf_get_last|mf_get_next|mf_get_next_at|mf_get_prev|mf_get_prev_at|mf_get_num_tracks|set_midi)"
				},
				{
					"name":  "support.function.builtin.ksp",
					"match": "(exit|ignore_controller|reset_ksp_timer)"
				}
			]
		}
	}
}
