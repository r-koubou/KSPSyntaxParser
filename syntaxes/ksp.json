{
    "scopeName":    "net.rkoubou.kontakt.ksp",
    "name":         "KSP",
    "comment":      "NI Kontakt Script syntax",
    "fileTypes": [
        "ksp",
        "txt"
    ],

    "patterns": [
        {
            "include": "#ksp_string_literal"
        },
        {
            "include": "#ksp_numeric_literal"
        },
        {
            "include": "#ksp_comments"
        },
        {
            "include": "#ksp_callback"
        },
        {
            "include": "#ksp_user_function"
        },
        {
            "include": "#ksp_variables"
        },
        {
            "include": "#ksp_ui_controls"
        },
        {
            "include": "#ksp_control_statements"
        },
        {
            "include": "#ksp_operators"
        },
        {
            "include": "#ksp_arithmetic_commands"
        },
        {
            "include": "#ksp_builtin_functions"
        },
        {
            "include": "#ksp_other_keyword"
        },
        {
            "include": "#ksp_ident"
        }
    ],
    "repository":
    {
        "ksp_string_literal":
        {
            "patterns":[
                {
                    "name":    "string.quoted.double.ksp",
                    "comment": "String literals",
                    "begin": "\"",
                    "beginCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.begin.ksp"
                        }
                    },
                    "end": "\"",
                    "endCaptures": {
                        "0": {
                            "name": "punctuation.definition.string.end.ksp"
                        }
                    }
                },
                {
                    "match": "\\\\.",
                    "name": "constant.character.escape.ksp"
                }

            ]
        },
        "ksp_numeric_literal":
        {
            "patterns":[
                {
                    "match": "\\\\([0-7]{3}|[abfnrtv\\\\'\"]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|U[0-9a-fA-F]{8})"
                },
                {
                    "match": "(?<![\\d.])\\s0x[a-fA-F\\d]+|\\b\\d+(\\.\\d+)?([eE]-?\\d+)?|\\.\\d+([eE]-?\\d+)?",
                    "name": "constant.numeric.ksp"
                }
            ]
        },
        "ksp_comments":
        {
            "patterns":[
                {
                    "begin": "\\{",
                    "captures":
                    {
                        "0":
                        {
                            "name": "punctuation.definition.comment.ksp"
                        }
                    },
                    "end": "\\}",
                    "name":"comment.block.ksp"
                }
            ]
        },
        "ksp_ident":
        {
            "patterns":[
                { "match": "([a-z|A-Z|_]+[a-z|A-Z|_|0-9]*)" }
            ]
        },
        "ksp_callback":
        {
            "patterns":[
                {
                    "name":  "keyword.callback.ksp",
                    "match": "on\\s+(async_complete|controller|init|listener|note|persistence_changed|pgs_changed|poly_at|release|rpn|nrpn|ui_control|ui_update|midi_in)\\b"
                },
                {
                    "name":  "keyword.callback.ksp",
                    "match": "end\\s+on\\b"
                }
            ]
        },
        "ksp_user_function":
        {
            "patterns":[
                {
                    "name":  "keyword.userfunction.ksp",
                    "match": "(function)\\b"
                },
                {
                    "name":  "keyword.userfunction.ksp",
                    "match": "end\\s+function\\b"
                }
            ]
        },
        "ksp_variables":
        {
            "patterns":[
                {
                    "name":  "variable.other.ksp",
                    "match": "(\\$|\\~|\\?|@|!|%)([a-z|A-Z|_]+[a-z|A-Z|_|0-9]*)"
                },
                {
                    "name":  "keyword.declare.ksp",
                    "match": "(declare|const|polyphonic)\\b"
                },
                {
                    "name": "variable.preprocessor.ksp",
                    "match": "(SET_CONDITION|RESET_CONDITION|USE_CODE_IF|USE_CODE_IF_NOT|END_USE_CODE|NO_SYS_SCRIPT_GROUP_START|NO_SYS_SCRIPT_PEDAL|NO_SYS_SCRIPT_RLS_TRIG)\\b"
                }
            ]
        },
        "ksp_ui_controls":
        {
            "patterns":[
                {
                    "name":  "keyword.other.ui.ksp",
                    "match": "(ui_button|ui_knob|ui_file_selector|ui_label|ui_level_meter|ui_menu|ui_slider|ui_switch|ui_table|ui_text_edit|ui_value_edit|ui_waveform)\\b"
                }
            ]
        },
        "ksp_control_statements":
        {
            "patterns":[
                {
                    "name":  "keyword.other.statements.ksp",
                    "match": "(if|else|end\\s+if|select|case|to|end\\s+select|while|end\\s+while)\\b"
                }
            ]
        },
        "ksp_operators":
        {
            "patterns":[
                {
                    "name":  "keyword.other.boolop1.ksp",
                    "match": "(and|or|not|in_range)\\b"
                },
                {
                    "name":  "keyword.other.bitop2.ksp",
                    "match": "(\\.and\\.|\\.or\\.|\\.not\\.|sh_left|sh_right)\\b"
                }
            ]
        },
        "ksp_arithmetic_commands":
        {
            "patterns":[
                {
                    "name":  "support.function.builtin.ksp",
                    "match": "(inc|dec|mod|exp|log|pow|sqrt|ceil|floor|round|cos|sin|tan|acos|asin|atan|sh_left|sh_right|random|int_to_real|real_to_int|msb|lsb)\\b"
                }
            ]
        },
        "ksp_builtin_functions":
        {
            "patterns":[
                {
                    "name":  "support.function.builtin.ksp",
                    "match": "(make_instr_persistent|make_instr_persistence|make_persistent|read_persistent_var)\\b"
                },
                {
                    "name":  "support.function.builtin.ksp",
                    "match": "(exit|ignore_controller|message|note_off|play_note|set_controller|set_rpn|set_nrpn|set_snapshot_type|by_marks|change_note|change_pan|change_tune|change_velo|change_vol|delete_event_mark|event_status|fade_in|fade_out|get_event_ids|get_event_par|get_event_par_arr|ignore_event|set_event_mark|set_event_par|set_event_par_arr|array_equal|num_elements|search|sort|allow_group|disallow_group|find_group|get_purge_state|group_name|purge_group|change_listener_par|ms_to_ticks|set_listener|stop_wait|reset_ksp_timer|ticks_to_ms|wait|wait_ticks|add_menu_item|add_text_line|attach_level_meter|attach_zone|hide_part|fs_get_filename|fs_navigate|get_control_par|get_menu_item_str|get_menu_item_value|get_menu_item_visibility|get_ui_id|get_ui_wf_property|make_perfview|move_control|move_control_px|set_control_help|set_control_par|set_control_par_str|set_control_par_arr|set_control_par_str_arr|set_knob_defval|set_knob_label|set_knob_unit|set_menu_item_str|set_menu_item_value|set_menu_item_visibility|set_table_steps_shown|set_script_title|set_skin_offset|set_text|set_ui_color|set_ui_height|set_ui_height_px|set_ui_width_px|set_ui_wf_property|get_key_color|get_key_name|get_key_triggerstate|get_key_type|get_keyrange_min_note|get_keyrange_max_note|get_keyrange_name|set_key_color|set_key_name|set_key_pressed|set_key_pressed_support|set_key_type|set_keyrange|remove_keyrange|find_mod|find_target|get_engine_par|get_engine_par_disp|get_voice_limit|output_channel_name|set_engine_par|set_voice_limit|get_folder|load_array|load_array_str|load_ir_sample|load_midi_file|save_array|save_array_str|save_midi_file|mf_insert_file|mf_set_export_area|mf_set_buffer_size|mf_get_buffer_size|mf_reset|mf_insert_event|mf_remove_event|mf_set_event_par|mf_get_event_par|mf_get_id|mf_set_mark|mf_get_mark|by_track|mf_get_first|mf_get_last|mf_get_next|mf_get_next_at|mf_get_prev|mf_get_prev_at|mf_get_num_tracks|mf_set_pos|mf_set_command|mf_set_byte_one|mf_set_byte_two|reset_rls_trig_counter|will_never_terminate|pgs_create_key|pgs_key_exists|pgs_set_key_val|pgs_get_key_val|pgs_create_str_key|pgs_str_key_exists|pgs_set_str_key_val|find_zone|get_sample_length|num_slices_zone|zone_slice_length|zone_slice_start|zone_slice_idx_loop_start|zone_slice_idx_loop_end|zone_slice_loop_count|dont_use_machine_mode|call|ignore_midi|set_midi)\\b"
                }
            ]
        },
        "ksp_other_keyword":
        {
            "patterns":[
                {
                    "name":  "keyword.other.ksp",
                    "match": "(on|end|function)\\b"
                }
            ]
        }
    }
}
